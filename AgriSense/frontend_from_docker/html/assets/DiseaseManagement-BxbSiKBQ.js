import{c as he,e as pe,r as c,j as e,B,m as d,_ as ue}from"./index-AQOmLPA_.js";import{C as o,b as u,c as g,d as $,a as m}from"./card-CJ0__Qs_.js";import{I as ge}from"./input-Cxy4wp14.js";import{L as v}from"./label-CDdM3ytP.js";import{S as I,a as L,b as k,c as z,d as x}from"./select-6AjSoAZR.js";import{A as G,a as W}from"./alert-CogJW0KU.js";import{B as R}from"./badge-jIK-DfEA.js";import{T as je,a as fe,b as q,c as J}from"./tabs-Bc9hHVt6.js";import{E as ye,C as b,U as H}from"./upload-CXcjxWqy.js";import{B as K}from"./brain-iA1XsMGs.js";import{L as Ne}from"./loader-circle-KFp7wWQw.js";import{T as w}from"./triangle-alert-BbTCmvuZ.js";import{C as y}from"./circle-check-big-DfF0k9Uj.js";import{T as _e}from"./trending-up-BTInFyYs.js";import{I as Y}from"./info-sMMaNAA1.js";const ve=he("BookOpen",[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]]),Ee=()=>{const{t:a}=pe(),[C,Q]=c.useState(null),[U,X]=c.useState(null),[O,N]=c.useState(!1),[r,S]=c.useState(null),[j,Z]=c.useState(""),[P,ee]=c.useState(""),E=c.useRef(null),[f,se]=c.useState(null),[F,ae]=c.useState("tomato"),[A,M]=c.useState(!1),[l,V]=c.useState(null),[T,D]=c.useState(null),te=["tomato","potato","corn","wheat","rice","soybean","bean","cotton","apple","grape","citrus","pepper","cucumber"],re=["seedling","vegetative","flowering","fruiting","mature"],le=c.useCallback(s=>{const t=s.target.files?.[0];if(t){const i=new FileReader;i.onloadend=()=>{se(i.result),V(null),D(null)},i.readAsDataURL(t)}},[]),ce=async()=>{if(f){M(!0),D(null);try{const s=f.split(",")[1],t=await fetch("http://localhost:8004/api/disease/detect",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image_data:s,crop_type:F})});if(!t.ok)throw new Error(`Analysis failed: ${t.statusText}`);const i=await t.json();V(i),d.success(a("scold_analysis_complete","SCOLD analysis completed!"))}catch(s){D(s instanceof Error?s.message:"Analysis failed"),d.error(a("scold_error","Error analyzing image")),console.error("SCOLD detection error:",s)}finally{M(!1)}}},ne=s=>{switch(s?.toLowerCase()){case"high":case"severe":return"text-red-600 bg-red-50 border-red-200";case"medium":case"moderate":return"text-yellow-600 bg-yellow-50 border-yellow-200";case"low":case"mild":return"text-green-600 bg-green-50 border-green-200";default:return"text-gray-600 bg-gray-50 border-gray-200"}},ie=s=>{const t=s.target.files?.[0];if(t){if(t.size>10*1024*1024){d.error("Image size must be less than 10MB");return}Q(t);const i=new FileReader;i.onload=_=>{X(_.target?.result)},i.readAsDataURL(t)}},de=async()=>{if(!C||!j){d.error("Please select an image and crop type");return}N(!0),S(null);try{const s=new FileReader;s.onload=async()=>{try{const i=s.result.split(",")[1];let _=!1;try{const{detectDiseaseWithScold:h}=await ue(async()=>{const{detectDiseaseWithScold:n}=await import("./aiModels-CYIggAQi.js");return{detectDiseaseWithScold:n}},[]);d.info("ðŸ” Using SCOLD VLM for advanced detection...");const p=await h(i,j);if(p.success&&p.detections.length>0){const n=p.detections[0],xe={primary_disease:n.disease,confidence:n.confidence,severity:n.severity||"medium",affected_area_percentage:n.affected_area_percent||0,recommended_treatments:n.treatment?[{treatment_type:"Immediate Action",product_name:n.treatment.immediate_actions.join(", "),application_rate:"As directed",frequency:"Once",cost_per_acre:0},{treatment_type:"Organic Methods",product_name:n.treatment.organic_methods.join(", "),application_rate:"As needed",frequency:"Weekly",cost_per_acre:0}]:[],prevention_tips:n.treatment?.preventive_measures||[],economic_impact:{potential_yield_loss:n.affected_area_percent||0,treatment_cost_estimate:0,cost_benefit_ratio:0},vlm_analysis:{knowledge_matches:p.detections.length,confidence_score:n.confidence,analysis_timestamp:p.timestamp}};S(xe),d.success("âœ… SCOLD VLM analysis completed!"),_=!0}}catch(h){console.info("SCOLD VLM unavailable, using fallback detection:",h)}if(!_){d.info("Using standard disease detection...");const h=await fetch(`${window.location.origin}/api/disease/detect`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image_data:i,crop_type:j,field_info:{growth_stage:P||"unknown"}})});if(!h.ok)throw new Error(`Analysis failed: ${h.statusText}`);const p=await h.json();S(p),d.success("Disease analysis completed!")}}catch(t){console.error("Analysis error:",t),d.error("Failed to analyze image. Please try again.")}finally{N(!1)}},s.onerror=()=>{console.error("File reading error"),d.error("Failed to read image file. Please try again."),N(!1)},s.readAsDataURL(C)}catch(s){console.error("Upload error:",s),d.error("Failed to process image. Please try again."),N(!1)}},oe=s=>{switch(s?.toLowerCase()){case"low":return"bg-green-100 text-green-800 border-green-200";case"medium":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"high":return"bg-red-100 text-red-800 border-red-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},me=s=>{switch(s?.toLowerCase()){case"low":return e.jsx(y,{className:"w-4 h-4"});case"medium":return e.jsx(Y,{className:"w-4 h-4"});case"high":return e.jsx(w,{className:"w-4 h-4"});default:return e.jsx(Y,{className:"w-4 h-4"})}};return e.jsxs("div",{className:"container mx-auto p-6 max-w-7xl",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground mb-2",children:a("nav_disease","Disease Management")}),e.jsx("p",{className:"text-muted-foreground",children:"Advanced AI-powered disease detection with multiple analysis methods"})]}),e.jsxs(je,{defaultValue:"scold",className:"w-full",children:[e.jsxs(fe,{className:"grid w-full grid-cols-2 mb-6",children:[e.jsxs(q,{value:"scold",className:"flex items-center gap-2",children:[e.jsx(ye,{className:"w-4 h-4"}),"SCOLD VLM Detection"]}),e.jsxs(q,{value:"standard",className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-4 h-4"}),"Standard Detection"]})]}),e.jsx(J,{value:"scold",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(o,{children:[e.jsxs(u,{children:[e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(b,{className:"w-5 h-5"}),a("scold_upload_image","Upload Plant Image")]}),e.jsx($,{children:a("scold_disease_subtitle","AI-powered plant disease identification using vision models")})]}),e.jsxs(m,{className:"space-y-4",children:[e.jsx("div",{className:"mb-4",children:f?e.jsx("img",{src:f,alt:"Selected plant",className:"w-full h-64 object-cover rounded-lg border-2 border-gray-200"}):e.jsx("div",{className:"w-full h-64 bg-gray-100 rounded-lg border-2 border-dashed border-gray-300 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(H,{className:"w-12 h-12 mx-auto mb-2 text-gray-400"}),e.jsx("p",{className:"text-gray-500",children:a("scold_no_image","No image selected")})]})})}),e.jsxs("label",{className:"block",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:le,className:"hidden"}),e.jsx("div",{className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 cursor-pointer text-center transition-colors",children:a("scold_choose_file","Choose Image File")})]}),e.jsxs("div",{children:[e.jsx(v,{className:"block text-sm font-medium text-gray-700 mb-2",children:a("scold_crop_type","Crop Type")}),e.jsxs(I,{value:F,onValueChange:ae,children:[e.jsx(L,{children:e.jsx(k,{})}),e.jsxs(z,{children:[e.jsx(x,{value:"tomato",children:a("crop_tomato","Tomato")}),e.jsx(x,{value:"potato",children:a("crop_potato","Potato")}),e.jsx(x,{value:"rice",children:a("crop_rice","Rice")}),e.jsx(x,{value:"wheat",children:a("crop_wheat","Wheat")}),e.jsx(x,{value:"corn",children:a("crop_corn","Corn")}),e.jsx(x,{value:"cotton",children:a("crop_cotton","Cotton")})]})]})]}),e.jsx(B,{onClick:ce,disabled:!f||A,className:"w-full",size:"lg",children:A?e.jsxs(e.Fragment,{children:[e.jsx(Ne,{className:"w-5 h-5 mr-2 animate-spin"}),a("scold_analyzing","Analyzing...")]}):a("scold_analyze_button","Analyze Disease")})]})]}),e.jsxs("div",{className:"space-y-4",children:[T&&e.jsxs(G,{variant:"destructive",children:[e.jsx(w,{className:"w-5 h-5"}),e.jsx(W,{children:T})]}),l&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(o,{children:e.jsx(m,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:a("scold_analysis_method","Analysis Method")}),e.jsx(R,{variant:"outline",className:"bg-blue-100 text-blue-800",children:l.analysis_method==="scold_vlm"?"SCOLD VLM":l.analysis_method})]})})}),e.jsx(o,{children:e.jsxs(m,{className:"pt-6 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:a("scold_overall_health","Overall Health")}),e.jsxs("div",{className:"flex items-center",children:[l.overall_health==="healthy"?e.jsx(y,{className:"w-5 h-5 text-green-600 mr-2"}):e.jsx(w,{className:"w-5 h-5 text-yellow-600 mr-2"}),e.jsx("span",{className:"font-semibold capitalize",children:l.overall_health})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-xs text-gray-600 mb-1",children:[e.jsx("span",{children:a("scold_confidence","Confidence")}),e.jsxs("span",{children:[(l.confidence*100).toFixed(1),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-green-600 h-2 rounded-full transition-all",style:{width:`${l.confidence*100}%`}})})]})]})}),l.detections&&l.detections.length>0&&e.jsxs(o,{children:[e.jsx(u,{children:e.jsxs(g,{className:"flex items-center text-lg",children:[e.jsx(_e,{className:"w-5 h-5 mr-2"}),a("scold_detected_diseases","Detected Diseases")]})}),e.jsx(m,{className:"space-y-3",children:l.detections.map((s,t)=>e.jsxs("div",{className:"border-l-4 border-blue-500 pl-4 py-2",children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("span",{className:"font-medium text-gray-900",children:s.disease_name}),e.jsx(R,{className:ne(s.severity),children:s.severity})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsxs("span",{children:[a("scold_confidence","Confidence"),": ",(s.confidence*100).toFixed(1),"%"]}),s.affected_area&&e.jsxs("span",{className:"ml-4",children:[a("scold_affected_area","Affected"),": ",s.affected_area.toFixed(1),"%"]})]})]},t))})]}),l.recommendations&&l.recommendations.length>0&&e.jsxs(o,{children:[e.jsx(u,{children:e.jsx(g,{className:"text-lg",children:a("scold_recommendations","Treatment Recommendations")})}),e.jsx(m,{children:e.jsx("ul",{className:"space-y-2",children:l.recommendations.map((s,t)=>e.jsxs("li",{className:"flex items-start",children:[e.jsx(y,{className:"w-4 h-4 text-green-600 mr-2 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-sm text-gray-700",children:s})]},t))})})]}),l.detections.length===0&&e.jsxs(G,{children:[e.jsx(y,{className:"w-5 h-5"}),e.jsx(W,{children:a("scold_no_diseases","No diseases detected - Plant appears healthy!")})]})]}),!l&&!T&&!A&&e.jsx(o,{className:"border-dashed",children:e.jsx(m,{className:"flex items-center justify-center h-64 text-center",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{className:"w-16 h-16 mx-auto text-gray-400"}),e.jsx("p",{className:"text-gray-600",children:a("scold_upload_prompt","Upload a plant image and click analyze to detect diseases")})]})})})]})]})}),e.jsxs(J,{value:"standard",className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(o,{children:[e.jsxs(u,{children:[e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(b,{className:"w-5 h-5"}),"Image Upload & Analysis"]}),e.jsx($,{children:"Upload a clear image of the affected crop for disease detection"})]}),e.jsxs(m,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"crop-type",children:"Crop Type *"}),e.jsxs(I,{value:j,onValueChange:Z,children:[e.jsx(L,{children:e.jsx(k,{placeholder:"Select crop type"})}),e.jsx(z,{children:te.map(s=>e.jsx(x,{value:s,children:s.charAt(0).toUpperCase()+s.slice(1)},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"growth-stage",children:"Growth Stage"}),e.jsxs(I,{value:P,onValueChange:ee,children:[e.jsx(L,{children:e.jsx(k,{placeholder:"Select growth stage (optional)"})}),e.jsx(z,{children:re.map(s=>e.jsx(x,{value:s,children:s.charAt(0).toUpperCase()+s.slice(1)},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"Image Upload"}),e.jsx("div",{className:"border-2 border-dashed border-muted-foreground/25 rounded-lg p-6 text-center cursor-pointer hover:border-muted-foreground/50 transition-colors",onClick:()=>E.current?.click(),children:U?e.jsxs("div",{className:"space-y-2",children:[e.jsx("img",{src:U,alt:"Preview",className:"max-w-full max-h-48 mx-auto rounded-lg"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Click to change image"})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{className:"w-8 h-8 mx-auto text-muted-foreground"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Click to upload or drag and drop"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Supports JPG, PNG (max 10MB)"})]})}),e.jsx(ge,{ref:E,type:"file",accept:"image/*",onChange:ie,className:"hidden"})]}),e.jsx(B,{onClick:de,disabled:!C||!j||O,className:"w-full",size:"lg",children:O?"Analyzing...":"Analyze for Diseases"})]})]}),r&&e.jsxs(o,{children:[e.jsx(u,{children:e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(w,{className:"w-5 h-5"}),"Disease Detection Results"]})}),e.jsxs(m,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:r.primary_disease.replace(/_/g," ").toUpperCase()}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Confidence: ",(r.confidence*100).toFixed(1),"%"]})]}),e.jsxs(R,{className:oe(r.severity),children:[me(r.severity),r.severity," Severity"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Affected Area"}),e.jsxs("p",{className:"font-semibold",children:[r.affected_area_percentage,"%"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Potential Yield Loss"}),e.jsxs("p",{className:"font-semibold text-red-600",children:[r.economic_impact.potential_yield_loss,"%"]})]})]}),r.recommended_treatments.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Recommended Treatments"}),e.jsx("div",{className:"space-y-2",children:r.recommended_treatments.slice(0,2).map((s,t)=>e.jsxs("div",{className:"bg-muted/50 p-3 rounded-lg text-sm",children:[e.jsx("div",{className:"font-medium",children:s.product_name}),e.jsxs("div",{className:"text-muted-foreground",children:[s.application_rate," â€¢ ",s.frequency]}),e.jsxs("div",{className:"text-green-600",children:["$",s.cost_per_acre,"/acre"]})]},t))})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 p-3 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-blue-800 mb-1",children:"Economic Impact"}),e.jsxs("div",{className:"text-sm text-blue-700",children:[e.jsxs("p",{children:["Treatment Cost: $",r.economic_impact.treatment_cost_estimate]}),e.jsxs("p",{children:["Cost-Benefit Ratio: ",r.economic_impact.cost_benefit_ratio,":1"]})]})]}),r.vlm_analysis&&e.jsxs("div",{className:"bg-purple-50 border border-purple-200 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(K,{className:"w-4 h-4 text-purple-600"}),e.jsx("h4",{className:"font-semibold text-purple-800",children:"VLM Enhanced Analysis"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-purple-600",children:"Knowledge Matches"}),e.jsx("p",{className:"font-semibold",children:r.vlm_analysis.knowledge_matches})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-purple-600",children:"AI Confidence"}),e.jsxs("p",{className:"font-semibold",children:[(r.vlm_analysis.confidence_score*100).toFixed(1),"%"]})]})]}),e.jsxs("div",{className:"mt-2 flex items-center gap-1 text-xs text-purple-700",children:[e.jsx(ve,{className:"w-3 h-3"}),e.jsx("span",{children:"Enhanced with agricultural knowledge base"})]})]})]})]}),!r&&e.jsx(o,{className:"border-dashed",children:e.jsx(m,{className:"flex items-center justify-center h-64 text-center",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"w-16 h-16 mx-auto bg-muted rounded-full flex items-center justify-center",children:e.jsx(b,{className:"w-8 h-8 text-muted-foreground"})}),e.jsx("p",{className:"text-muted-foreground",children:"Upload an image to see disease analysis results"})]})})})]}),r?.prevention_tips&&r.prevention_tips.length>0&&e.jsxs(o,{className:"mt-6",children:[e.jsx(u,{children:e.jsx(g,{children:"Prevention Tips"})}),e.jsx(m,{children:e.jsx("ul",{className:"space-y-2",children:r.prevention_tips.map((s,t)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(y,{className:"w-4 h-4 text-green-600 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:s})]},t))})})]})]})]})]})};export{Ee as default};
