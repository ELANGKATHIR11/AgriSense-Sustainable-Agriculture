import{r as o,j as e,B as d}from"./index-AQOmLPA_.js";import{C as x,b as k,c as _,a as p}from"./card-CJ0__Qs_.js";import{B as w}from"./badge-jIK-DfEA.js";import{A as S,a as A}from"./alert-CogJW0KU.js";import{T as O}from"./thermometer-DecLzMp6.js";import{W}from"./wifi-DvT0O9kU.js";import{W as B}from"./wifi-off-DLaa_muy.js";import{C as D}from"./circle-alert-DDcVp7KT.js";const U=()=>{const[n,i]=o.useState({connected:!1,port:null,error:null}),[c,h]=o.useState({temperature:null,humidity:null,timestamp:"",device_id:"ARDUINO_NANO_01"}),[y,N]=o.useState(""),[v,b]=o.useState(!1),m=o.useRef(null),u=o.useRef(null),f="serial"in navigator,R=async()=>{if(!f){i({connected:!1,port:null,error:"Web Serial API not supported in this browser. Use Chrome/Edge."});return}try{const r=await navigator.serial.requestPort({filters:[{usbVendorId:9025},{usbVendorId:6790},{usbVendorId:1027}]});await r.open({baudRate:115200,dataBits:8,stopBits:1,parity:"none"}),i({connected:!0,port:r,error:null}),T(r)}catch(r){const t=r instanceof Error?r.message:"Failed to connect to Arduino";i({connected:!1,port:null,error:t})}},j=o.useCallback(async()=>{try{b(!1),u.current&&u.current.abort(),m.current&&(await m.current.cancel(),m.current=null),n.port&&await n.port.close(),i({connected:!1,port:null,error:null})}catch(r){console.error("Error disconnecting:",r)}},[n.port]),T=async r=>{b(!0),u.current=new AbortController;try{const t=new TextDecoderStream;r.readable.pipeTo(t.writable);const a=t.readable.getReader();for(m.current=a;v&&!u.current.signal.aborted;)try{const{value:s,done:l}=await a.read();if(l)break;s&&(N(g=>g+s),E(s.trim()))}catch(s){s instanceof Error&&s.name!=="AbortError"&&console.error("Read error:",s);break}}catch(t){console.error("Reading error:",t);const a=t instanceof Error?t.message:"Unknown reading error";i(s=>({...s,error:"Reading error: "+a}))}},E=r=>{try{if(r.startsWith("DATA:")){const t=r.substring(5),a=JSON.parse(t),s=a.temperatures||{},l=a.avg_temperature,g=a.humidity;h({temperature:l||s.ds18b20||s.dht22||null,humidity:g||null,timestamp:new Date().toISOString(),device_id:a.device_id||"ARDUINO_NANO_01"})}else{const t=parseFloat(r);isNaN(t)||h(a=>({...a,temperature:t,timestamp:new Date().toISOString()}))}}catch{const a=r.match(/(\d+\.?\d*)/);if(a){const s=parseFloat(a[1]);!isNaN(s)&&s>-50&&s<100&&h(l=>({...l,temperature:s,timestamp:new Date().toISOString()}))}}},C=async r=>{if(n.port&&n.connected)try{const t=n.port.writable.getWriter();await t.write(new TextEncoder().encode(r+`
`)),t.releaseLock()}catch(t){console.error("Error sending command:",t)}},I=r=>r?new Date(r).toLocaleTimeString():"--";return o.useEffect(()=>()=>{n.connected&&j()},[n.connected,j]),e.jsx("div",{className:"space-y-6",children:e.jsxs(x,{children:[e.jsx(k,{children:e.jsxs(_,{className:"flex items-center gap-2",children:[e.jsx(O,{className:"h-5 w-5"}),"Arduino Temperature Sensor",n.connected?e.jsxs(w,{className:"bg-green-500",children:[e.jsx(W,{className:"h-3 w-3 mr-1"}),"Connected"]}):e.jsxs(w,{variant:"secondary",children:[e.jsx(B,{className:"h-3 w-3 mr-1"}),"Disconnected"]})]})}),e.jsxs(p,{className:"space-y-4",children:[!f&&e.jsxs(S,{children:[e.jsx(D,{className:"h-4 w-4"}),e.jsx(A,{children:"Web Serial API is not supported in this browser. Please use Chrome, Edge, or another Chromium-based browser."})]}),n.error&&e.jsxs(S,{variant:"destructive",children:[e.jsx(D,{className:"h-4 w-4"}),e.jsx(A,{children:n.error})]}),e.jsxs("div",{className:"flex gap-2",children:[n.connected?e.jsx(d,{onClick:j,variant:"outline",children:"Disconnect"}):e.jsx(d,{onClick:R,disabled:!f,className:"bg-blue-600 hover:bg-blue-700",children:"Connect to Arduino"}),n.connected&&e.jsxs(e.Fragment,{children:[e.jsx(d,{onClick:()=>C("READ"),variant:"outline",size:"sm",children:"Read Sensors"}),e.jsx(d,{onClick:()=>C("STATUS"),variant:"outline",size:"sm",children:"Get Status"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(x,{children:e.jsxs(p,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold",children:c.temperature!==null?`${c.temperature.toFixed(1)}°C`:"--°C"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Temperature"})]})}),c.humidity!==null&&e.jsx(x,{children:e.jsxs(p,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold",children:`${c.humidity.toFixed(1)}%`}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Humidity"})]})}),e.jsx(x,{children:e.jsxs(p,{className:"pt-6",children:[e.jsx("div",{className:"text-sm font-mono",children:I(c.timestamp)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Last Update"})]})})]}),n.connected&&e.jsxs("details",{className:"mt-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-medium",children:"Raw Serial Data (Debug)"}),e.jsx("pre",{className:"mt-2 p-2 bg-gray-100 rounded text-xs max-h-32 overflow-auto font-mono",children:y||"No data received yet..."}),e.jsx(d,{onClick:()=>N(""),variant:"outline",size:"sm",className:"mt-2",children:"Clear Log"})]}),e.jsxs("details",{className:"mt-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm font-medium",children:"Arduino Setup Instructions"}),e.jsxs("div",{className:"mt-2 space-y-2 text-sm",children:[e.jsx("p",{children:e.jsx("strong",{children:"Hardware Connection:"})}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-xs",children:[e.jsx("li",{children:"Connect DS18B20: VCC→5V, GND→GND, Data→Pin 2, 4.7kΩ resistor between VCC and Data"}),e.jsx("li",{children:"Connect DHT22: VCC→5V, GND→GND, Data→Pin 3, 10kΩ resistor between VCC and Data"}),e.jsx("li",{children:"Upload the AgriSense Arduino firmware from AGRISENSE_IoT/arduino_nano_firmware/"}),e.jsx("li",{children:"Connect Arduino to computer via USB cable"})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Required Libraries:"})," OneWire, DallasTemperature, DHT sensor library, ArduinoJson"]})]})]})]})]})})},q=()=>e.jsxs("div",{className:"p-6 max-w-6xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Arduino Sensor Integration"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Connect and monitor temperature sensors directly from Arduino Nano via USB cable."})]}),e.jsx(U,{})]});export{q as default};
