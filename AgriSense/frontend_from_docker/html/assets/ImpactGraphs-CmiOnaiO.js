import{e as b,r as o,j as e}from"./index-AQOmLPA_.js";import{a as y}from"./api-wEynFWk2.js";import{C as d}from"./card-CJ0__Qs_.js";import{T as S,a as T,b as j,c as v}from"./tabs-Bc9hHVt6.js";import{S as Z,a as C,b as E,c as M,d as _}from"./select-6AjSoAZR.js";function g({points:s,color:m="#16a34a"}){if(!s.length)return e.jsx("div",{className:"h-12"});const u=320,t=60,i=6,h=Math.min(...s),p=Math.max(...s)-h||1,f=(u-i*2)/Math.max(1,s.length-1),c=s.map((n,l)=>{const x=i+l*f,r=t-i-(n-h)/p*(t-i*2);return`${l===0?"M":"L"}${x},${r}`}).join(" ");return e.jsx("svg",{width:u,height:t,className:"overflow-visible",children:e.jsx("path",{d:c,fill:"none",stroke:m,strokeWidth:2})})}function V(){const{t:s}=b(),[m,u]=o.useState("Z1"),[t,i]=o.useState([]),[h,N]=o.useState(!0),[p,f]=o.useState(null);o.useEffect(()=>{let n=!0;const l=async()=>{try{const r=await y.recoRecent(m,200);if(!n)return;i((r.items||[]).slice().reverse()),f(null)}catch(r){if(!n)return;f(r instanceof Error?r.message:String(r))}finally{n&&N(!1)}};l();const x=setInterval(l,7e3);return()=>{n=!1,clearInterval(x)}},[m]);const c=o.useMemo(()=>{const n=t.map(a=>a.ts),l=t.map(a=>Number(a.water_liters??0)),x=t.map(a=>Number(a.expected_savings_liters??0)),r=t.map(a=>Number((a.fert_n_g??0)+(a.fert_p_g??0)+(a.fert_k_g??0))),w=t.map(a=>Number(a.yield_potential??0));return{ts:n,water:l,savings:x,fertTotal:r,yieldPotential:w}},[t]);return e.jsxs("div",{className:"container mx-auto p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("h1",{className:"text-2xl font-semibold",children:s("impact_over_time")}),e.jsxs(Z,{value:m,onValueChange:u,children:[e.jsx(C,{className:"w-32",children:e.jsx(E,{placeholder:s("zone_label")})}),e.jsxs(M,{children:[e.jsx(_,{value:"Z1",children:"Z1"}),e.jsx(_,{value:"Z2",children:"Z2"}),e.jsx(_,{value:"Z3",children:"Z3"})]})]})]}),p&&e.jsx("div",{className:"text-sm text-red-600",children:p}),!t.length&&!h&&e.jsx(d,{className:"p-4 text-sm text-muted-foreground",children:s("no_reco_snapshots")}),e.jsxs(S,{defaultValue:"savings",className:"w-full",children:[e.jsxs(T,{children:[e.jsx(j,{value:"savings",children:s("water_savings_l")}),e.jsx(j,{value:"water",children:s("water_applied_l")}),e.jsx(j,{value:"fert",children:s("fertilizer_total_g")}),e.jsx(j,{value:"yield",children:s("yield_potential")})]}),e.jsx(v,{value:"savings",children:e.jsx(d,{className:"p-4",children:e.jsx(g,{points:c.savings,color:"#0ea5e9"})})}),e.jsx(v,{value:"water",children:e.jsx(d,{className:"p-4",children:e.jsx(g,{points:c.water,color:"#22c55e"})})}),e.jsx(v,{value:"fert",children:e.jsx(d,{className:"p-4",children:e.jsx(g,{points:c.fertTotal,color:"#f59e0b"})})}),e.jsx(v,{value:"yield",children:e.jsx(d,{className:"p-4",children:e.jsx(g,{points:c.yieldPotential,color:"#a855f7"})})})]}),e.jsx(d,{className:"p-4",children:e.jsx("div",{className:"text-sm text-muted-foreground",children:"These graphs show your reduced water and fertilizer usage and any increase in predicted yield over time."})})]})}export{V as default};
