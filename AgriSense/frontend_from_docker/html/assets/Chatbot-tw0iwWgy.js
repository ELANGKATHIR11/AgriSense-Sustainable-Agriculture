import{c as A,e as P,r as i,j as e,M as L,B as _}from"./index-AQOmLPA_.js";import{C as R,b as z,c as q,a as H}from"./card-CJ0__Qs_.js";import{B as O}from"./brain-iA1XsMGs.js";import{R as K}from"./refresh-cw-DfHxVQm6.js";const U=A("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);const B=A("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]);function F(){return`session-${Date.now()}-${Math.random().toString(36).substring(7)}`}function X(){const{t,i18n:m}=P(),[u,c]=i.useState(""),[G,Y]=i.useState("Z1"),[h,l]=i.useState([]),[d,y]=i.useState(!1),[p]=i.useState(F()),[f,M]=i.useState(!1),[D,j]=i.useState(0),[Z,w]=i.useState(!1),N=i.useRef(null),v=i.useRef(null);i.useEffect(()=>{N.current?.scrollIntoView({behavior:"smooth"})},[h]),i.useEffect(()=>{(async()=>{try{const o=m.language||"en",r=await fetch(`http://localhost:8004/chatbot/greeting?language=${o}`);if(r.ok){const n=await r.json();l([{role:"assistant",text:n.greeting}])}}catch(o){console.error("Failed to load greeting:",o),l([{role:"assistant",text:t("chatbot.welcome","Hello! I'm here to help with your farming questions. ðŸ˜Š")}])}})()},[m.language,t]);const k=async()=>{const s=u.trim();if(!s)return;const o=new Date().toLocaleTimeString();l(r=>[...r,{role:"user",text:s,timestamp:o}]),c(""),y(!0),w(!0);try{const r=m.language||"en",n=await fetch("http://localhost:8004/chatbot/ask",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:s,top_k:5,session_id:p,language:r,include_sources:!0})});if(!n.ok){const a=await n.json().catch(()=>({detail:`HTTP ${n.status}`}));throw new Error(a.detail||`HTTP ${n.status}`)}const g=await n.json();if(g.results&&g.results.length>0){const a=g.results[0],S=a.answer||a.original_answer||"No answer found.",b=[],C=S.match(/ðŸ’¡.*?:\s*\n((?:â€¢.*?\n?)+)/);if(C){const x=C[1].match(/â€¢\s*(.+)/g);x&&b.push(...x.map(E=>E.replace(/^â€¢\s*/,"").trim()).slice(0,3))}const T=a.sources||[];l(x=>[...x,{role:"assistant",text:S,originalText:a.original_answer,followUps:b.length>0?b:void 0,sources:T.length>0?T:void 0,timestamp:new Date().toLocaleTimeString(),enhanced:!!a.original_answer||!!a.phi_enhanced,phi_enhanced:!!a.phi_enhanced}]),j(0)}else l(a=>[...a,{role:"assistant",text:t("chatbot.no_answer","I couldn't find an answer. Please try rephrasing your question or ask about specific crops, diseases, or farming practices.")}])}catch(r){const n=r instanceof Error?r.message:String(r);j(a=>a+1);const g=D<2?`${t("chatbot.error","I'm having trouble connecting. Please try again.")} (${n})`:`${t("chatbot.error_persistent","Connection issues persist. Please check your internet or try later.")} (${n})`;l(a=>[...a,{role:"assistant",text:g,timestamp:new Date().toLocaleTimeString()}])}finally{y(!1),w(!1),v.current?.focus()}},I=s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),k()),(s.ctrlKey||s.metaKey)&&s.key==="k"&&(s.preventDefault(),confirm(t("chatbot.clear_confirm","Clear all messages?"))&&(l([]),c("")))},$=s=>{c(s)};return e.jsx("div",{className:"max-w-4xl mx-auto p-6 space-y-4",children:e.jsxs(R,{children:[e.jsxs(z,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-br from-green-500 to-emerald-600 rounded-lg",children:e.jsx(L,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsxs(q,{className:"flex items-center gap-2",children:[t("chatbot.title","Agricultural Assistant Chatbot"),e.jsxs("span",{className:"flex items-center gap-1 text-xs font-normal text-green-600 dark:text-green-400",children:[e.jsx(O,{className:"w-3 h-3"}),t("chatbot.ai_powered","AI-Powered")]})]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[h.length," ",t("chatbot.messages","messages")," â€¢ Session: ",p.substring(8,16)]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(_,{variant:"outline",size:"sm",onClick:()=>M(!f),className:"text-xs",children:f?t("chatbot.hide_original","Hide Original"):t("chatbot.show_original","Show Original")})})]}),e.jsxs(H,{className:"space-y-4",children:[e.jsx("div",{className:"border rounded-lg p-4 min-h-[400px] max-h-[600px] overflow-y-auto bg-gray-50 dark:bg-gray-900",children:h.length===0?e.jsx("div",{className:"flex items-center justify-center h-full text-sm text-muted-foreground",children:d?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-green-600"}),e.jsx("span",{children:t("chatbot.loading","Loading...")})]}):t("chatbot.placeholder","Ask about irrigation, fertilizers, crops, pests, or diseases...")}):e.jsxs("div",{className:"space-y-4",children:[h.map((s,o)=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:`flex ${s.role==="user"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[80%] rounded-lg px-4 py-3 shadow-sm animate-in fade-in slide-in-from-bottom-2 duration-300 ${s.role==="user"?"bg-gradient-to-br from-blue-600 to-blue-700 text-white shadow-blue-500/20":"bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 border border-gray-200 dark:border-gray-700 shadow-lg"}`,children:[e.jsxs("div",{className:"text-xs font-semibold mb-1 opacity-75 flex items-center gap-1 justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[s.role==="assistant"&&e.jsx("span",{className:"text-base",children:"ðŸŒ±"}),s.role==="user"?t("chatbot.you","You"):t("chatbot.assistant","AgriSense Assistant"),s.role==="assistant"&&s.enhanced&&e.jsxs("span",{className:"flex items-center gap-1 text-green-600 dark:text-green-400",children:[e.jsx(B,{className:"w-3 h-3"}),e.jsx("span",{className:"text-[10px]",children:s.phi_enhanced?t("chatbot.phi_enhanced","âœ¨ Phi AI"):t("chatbot.enhanced","Enhanced")})]})]}),s.timestamp&&e.jsx("span",{className:"text-[10px] opacity-60",children:s.timestamp})]}),e.jsx("div",{className:"text-sm whitespace-pre-wrap leading-relaxed",children:s.text}),s.role==="assistant"&&f&&s.originalText&&s.originalText!==s.text&&e.jsxs("details",{className:"mt-2 pt-2 border-t border-gray-200 dark:border-gray-600",children:[e.jsx("summary",{className:"text-xs cursor-pointer text-gray-600 dark:text-gray-400",children:t("chatbot.original_answer","Original Answer")}),e.jsx("div",{className:"mt-2 text-xs text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 p-2 rounded",children:s.originalText})]})]})}),s.role==="assistant"&&s.followUps&&s.followUps.length>0&&e.jsxs("div",{className:"ml-2 space-y-2",children:[e.jsxs("div",{className:"text-xs text-gray-600 dark:text-gray-400 font-medium",children:["ðŸ’¡ ",t("chatbot.suggested_questions","You might also want to know:")]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.followUps.map((r,n)=>e.jsx("button",{onClick:()=>$(r),className:"text-xs px-3 py-1.5 rounded-full border border-green-600 text-green-700 dark:text-green-400 hover:bg-green-50 dark:hover:bg-green-900/20 transition-colors",children:r},n))})]})]},o)),d&&e.jsx("div",{className:"flex justify-start",children:e.jsx("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg px-4 py-3 shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})})}),e.jsx("div",{ref:N})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{ref:v,className:"border border-gray-300 dark:border-gray-700 px-4 py-3 rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-green-500 dark:bg-gray-800",placeholder:t("chatbot.input_placeholder","Type your farming question..."),value:u,onChange:s=>c(s.target.value),onKeyDown:I,disabled:d}),e.jsx(_,{onClick:k,disabled:d||!u.trim(),className:"px-4 flex items-center gap-2 bg-green-600 hover:bg-green-700",children:d?e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{className:"hidden sm:inline",children:t("chatbot.thinking","Thinking...")})]}):e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:t("chatbot.send","Send")})]})})]}),e.jsx("div",{className:"flex flex-wrap gap-2 justify-center",children:["How to grow tomatoes?","Best fertilizer for rice?","Pest control tips"].map((s,o)=>e.jsxs("button",{onClick:()=>c(s),className:"text-xs px-3 py-1.5 rounded-full bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-400 hover:bg-green-100 dark:hover:bg-green-900/30 transition-colors border border-green-200 dark:border-green-800",children:["ðŸ’¡ ",s]},o))}),e.jsxs("div",{className:"text-xs text-center text-muted-foreground space-y-1",children:[e.jsx("div",{children:t("chatbot.footer","Ask questions about crops, irrigation, fertilizers, pests, diseases, and more!")}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsxs("span",{className:"text-green-600 dark:text-green-400 font-mono",children:["Session: ",p.substring(0,15),"..."]}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{className:"text-gray-500",children:"Press Enter to send â€¢ Ctrl+K to clear"})]})]})]})]})})}export{X as default};
