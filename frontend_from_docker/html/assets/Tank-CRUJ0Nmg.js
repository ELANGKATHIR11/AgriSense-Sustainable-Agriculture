import{j as e,u as y,r as n}from"./index-AQOmLPA_.js";import{a as b}from"./api-wEynFWk2.js";function S({percent:r=0,liters:s}){const l=Math.max(0,Math.min(100,Number(r??0))),a=2*Math.PI*45,c=a*(1-l/100),i=l<30?"#ef4444":l<60?"#f59e0b":"#10b981";return e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("svg",{width:"120",height:"120",viewBox:"0 0 120 120",children:[e.jsx("circle",{cx:"60",cy:"60",r:"50",fill:"none",stroke:"#e5e7eb",strokeWidth:"10"}),e.jsx("circle",{cx:"60",cy:"60",r:"45",fill:"none",stroke:i,strokeWidth:"10",strokeDasharray:`${a} ${a}`,strokeDashoffset:c,strokeLinecap:"round",transform:"rotate(-90 60 60)"}),e.jsxs("text",{x:"60",y:"58",textAnchor:"middle",fontSize:"18",fontWeight:"600",fill:"#111827",children:[Math.round(l),"%"]}),e.jsx("text",{x:"60",y:"78",textAnchor:"middle",fontSize:"10",fill:"#6b7280",children:s!=null?`${Math.round(s)} L`:""})]})})}const T=()=>{const{toast:r}=y(),[s,l]=n.useState("T1"),[a,c]=n.useState(null),[i,m]=n.useState(""),[x,p]=n.useState(""),[d,h]=n.useState(""),[g,f]=n.useState(!1),u=async()=>{try{const t=await b.tankStatus(s);c(t)}catch(t){const o=t instanceof Error?t.message:String(t);r({title:"Failed to load tank status",description:o,variant:"destructive"})}};n.useEffect(()=>{u();const t=setInterval(u,1e4);return()=>clearInterval(t)},[s]);const v=async t=>{t.preventDefault(),f(!0);try{await b.tankLevel(s,Number(i),Number(x),d?Number(d):void 0),r({title:"Tank updated"}),m(""),p(""),h(""),await u()}catch(o){const k=o instanceof Error?o.message:String(o);r({title:"Failed to update tank",description:k,variant:"destructive"})}finally{f(!1)}},j=a?.level_pct??null,N=a?.volume_l??null;return e.jsxs("div",{className:"max-w-3xl mx-auto p-4",children:[e.jsxs("div",{className:"bg-white dark:bg-card shadow-md rounded-lg p-4 mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-green-700 dark:text-green-400 mb-1",children:"ðŸŒ± Tank & Irrigation Status"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Monitor tank level and update readings"})]}),e.jsxs("div",{className:"flex items-center gap-6 mb-6 bg-white dark:bg-card shadow-md rounded-lg p-4",children:[e.jsx(S,{percent:j,liters:N??void 0}),e.jsxs("div",{children:[e.jsxs("label",{className:"form-control w-36",children:[e.jsx("span",{className:"label-text text-sm text-muted-foreground",children:"Tank ID"}),e.jsx("input",{id:"tank-id",type:"text",className:"input input-bordered",value:s,onChange:t=>l(t.target.value),placeholder:"e.g., T1",title:"Tank ID",autoComplete:"off"})]}),e.jsxs("div",{className:"mt-2 text-sm",children:["Capacity: ",a?.capacity_liters??0," L"]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Last update: ",a?.last_update??"-"]})]})]}),e.jsxs("form",{onSubmit:v,className:"space-y-3 bg-white dark:bg-card shadow-md rounded-lg p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsxs("label",{className:"form-control",children:[e.jsx("span",{className:"label-text",children:"Level %"}),e.jsx("input",{type:"number",step:"0.1",className:"input input-bordered",value:i,onChange:t=>m(t.target.value),placeholder:"e.g., 42"})]}),e.jsxs("label",{className:"form-control",children:[e.jsx("span",{className:"label-text",children:"Volume (L)"}),e.jsx("input",{type:"number",step:"1",className:"input input-bordered",value:x,onChange:t=>p(t.target.value),placeholder:"e.g., 500"})]}),e.jsxs("label",{className:"form-control",children:[e.jsx("span",{className:"label-text",children:"Rainfall (mm)"}),e.jsx("input",{type:"number",step:"0.1",className:"input input-bordered",value:d,onChange:t=>h(t.target.value),placeholder:"optional"})]})]}),e.jsx("button",{className:"btn btn-primary",type:"submit",disabled:g,children:g?"Saving...":"Update Tank"})]})]})};export{T as default};
