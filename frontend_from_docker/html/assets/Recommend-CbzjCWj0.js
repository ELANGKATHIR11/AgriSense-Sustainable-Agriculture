import{c as J,r as o,u as xe,e as he,j as e,B as x,D as U,Z as b}from"./index-AQOmLPA_.js";import{C as w,b as S,c as F,d as C,a as M}from"./card-CJ0__Qs_.js";import{I as h}from"./input-Cxy4wp14.js";import{L as m}from"./label-CDdM3ytP.js";import{S as P,a as q,b as B,c as A,d as W}from"./select-6AjSoAZR.js";import{B as Z}from"./badge-jIK-DfEA.js";import{a as p}from"./api-wEynFWk2.js";import{W as G}from"./wifi-DvT0O9kU.js";import{R as H}from"./refresh-cw-DfHxVQm6.js";import{T}from"./thermometer-DecLzMp6.js";import{G as O,B as Q}from"./gauge-DB88xEnu.js";import{W as V}from"./wifi-off-DLaa_muy.js";import{T as K}from"./trending-up-BTInFyYs.js";import{C as pe}from"./circle-check-big-DfF0k9Uj.js";import{C as ue}from"./circle-alert-DDcVp7KT.js";const je=J("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);const ge=J("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]),ze=()=>{const[r,N]=o.useState({temperature:"",humidity:"",soilMoisture:"",ph:"",nitrogen:"",phosphorus:"",potassium:"",cropType:"",soilType:"loam",areaM2:"100"}),[i,L]=o.useState(null),[j,g]=o.useState(!1),[X,Y]=o.useState([]),[$,ee]=o.useState(["sand","loam","clay"]),[u,se]=o.useState({}),[l,te]=o.useState(null),[D,ae]=o.useState([]),[ve,re]=o.useState(!1),[v,k]=o.useState(!1),[R,ie]=o.useState(""),{toast:n}=xe(),{t}=he();o.useEffect(()=>{let s=!1;return(async()=>{try{const a=await p.plants();s||Y(a.items);const d=await p.soilTypes();!s&&d.items?.length&&ee(d.items)}catch{}})(),()=>{s=!0}},[]);const z=async()=>{k(!0);try{const[s,a]=await Promise.all([p.sensorsLive().catch(()=>null),p.sensorsDeviceStatus().catch(()=>({devices:[]}))]);if(s&&s.status==="success"){let d;if(s.data&&typeof s.data=="object"&&"device_id"in s.data)d=s.data;else if(s.data&&typeof s.data=="object")d=Object.values(s.data)[0];else throw new Error("No sensor data available");te(d),ie(new Date().toLocaleTimeString()),n({title:"Live Data Updated",description:"Sensor data refreshed successfully"})}a&&a.devices&&ae(a.devices)}catch(s){console.error("Failed to fetch live sensor data:",s),n({title:"Sensor Data Error",description:"Unable to fetch live sensor data. MQTT bridge may not be running.",variant:"destructive"})}finally{k(!1)}},le=()=>{if(!l){n({title:"No Live Data",description:"Please fetch live sensor data first",variant:"destructive"});return}N(s=>({...s,temperature:l.air_temperature.toFixed(1),humidity:l.humidity.toFixed(1),soilMoisture:l.soil_moisture_percentage.toFixed(1),ph:l.ph_level.toFixed(1)})),re(!0),n({title:"Live Data Applied",description:"Sensor values automatically filled"})},ne=async()=>{g(!0);try{const s=await p.sensorsRecommendationsLive();L(s.recommendations),s.sensor_data&&N(a=>({...a,temperature:s.sensor_data.air_temperature.toFixed(1),humidity:s.sensor_data.humidity.toFixed(1),soilMoisture:s.sensor_data.soil_moisture_percentage.toFixed(1),ph:s.sensor_data.ph_level.toFixed(1)})),n({title:"Live Recommendations",description:"Recommendations generated from real-time sensor data"})}catch(s){console.error("Failed to get live recommendations:",s),n({title:"Live Recommendations Failed",description:"Unable to get live recommendations. Using manual input instead.",variant:"destructive"}),await E()}finally{g(!1)}},c=(s,a)=>{N(me=>({...me,[s]:a}));const d={},f=parseFloat(s==="ph"?a||"NaN":r.ph||"NaN");!Number.isNaN(f)&&(f<3.5||f>9.5)&&(d.ph=t("warn_ph_range"));const _=parseFloat(s==="soilMoisture"?a||"NaN":r.soilMoisture||"NaN");!Number.isNaN(_)&&(_<0||_>100)&&(d.soilMoisture=t("warn_moisture_range"));const y=parseFloat(s==="temperature"?a||"NaN":r.temperature||"NaN");!Number.isNaN(y)&&(y<-10||y>60)&&(d.temperature=t("warn_temp_range"));const I=parseFloat(s==="areaM2"?a||"NaN":r.areaM2||"NaN");!Number.isNaN(I)&&I<=0&&(d.areaM2=t("warn_area_positive")),se(d)},E=async()=>{g(!0);try{const s={plant:r.cropType||"generic",soil_type:(r.soilType||"loam").toLowerCase(),area_m2:Math.max(1,parseFloat(r.areaM2||"100")),ph:parseFloat(r.ph||"6.5"),moisture_pct:parseFloat(r.soilMoisture||"40"),temperature_c:parseFloat(r.temperature||"28"),ec_dS_m:1,n_ppm:r.nitrogen?parseFloat(r.nitrogen):void 0,p_ppm:r.phosphorus?parseFloat(r.phosphorus):void 0,k_ppm:r.potassium?parseFloat(r.potassium):void 0},a=await p.recommend(s);L(a),n({title:"Analysis Complete",description:"Smart recommendations generated."})}catch(s){const a=s instanceof Error?s.message:String(s);n({title:"Request failed",description:a,variant:"destructive"})}finally{g(!1)}},de=async()=>{try{const s=i?.suggested_runtime_min?Math.max(1,Math.round(i.suggested_runtime_min*60)):Math.max(60,Math.round((i?.water_liters||0)/Math.max(1,i?.assumed_flow_lpm||20)*60)),a=await p.irrigationStart("Z1",s);n({title:a.ok?"Irrigation start sent":"Queued",description:a.status})}catch(s){const a=s instanceof Error?s.message:String(s);n({title:"Failed to start",description:a,variant:"destructive"})}},oe=async()=>{try{const s=await p.irrigationStop("Z1");n({title:s.ok?"Stop sent":"Stop queued",description:s.status})}catch(s){const a=s instanceof Error?s.message:String(s);n({title:"Failed to stop",description:a,variant:"destructive"})}},ce=s=>{switch(s){case"high":return e.jsx(ue,{className:"w-4 h-4 text-destructive"});case"medium":return e.jsx(K,{className:"w-4 h-4 text-accent-foreground"});default:return e.jsx(pe,{className:"w-4 h-4 text-primary"})}};return e.jsx("div",{className:"min-h-screen bg-gradient-secondary",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground mb-2",children:t("smart_recommendations")}),e.jsx("p",{className:"text-muted-foreground",children:t("enter_sensor_prompt")})]}),e.jsxs(w,{className:"mb-8 shadow-medium border-primary/20",children:[e.jsxs(S,{children:[e.jsxs(F,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(G,{className:"w-5 h-5 text-primary"}),e.jsx("span",{children:"Live Sensor Data"}),e.jsx(Z,{variant:l?"default":"secondary",children:l?"Connected":"No Data"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(x,{variant:"outline",size:"sm",onClick:z,disabled:v,children:[v?e.jsx(H,{className:"w-4 h-4 animate-spin mr-2"}):e.jsx(H,{className:"w-4 h-4 mr-2"}),"Refresh"]}),l&&e.jsx(x,{variant:"default",size:"sm",onClick:le,children:"Use Live Data"})]})]}),R&&e.jsxs(C,{children:["Last updated: ",R]})]}),e.jsxs(M,{children:[l?e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(T,{className:"w-4 h-4 text-orange-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Air Temp"}),e.jsxs("p",{className:"text-lg font-semibold",children:[l.air_temperature.toFixed(1),"°C"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(U,{className:"w-4 h-4 text-blue-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Humidity"}),e.jsxs("p",{className:"text-lg font-semibold",children:[l.humidity.toFixed(1),"%"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(O,{className:"w-4 h-4 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Soil Moisture"}),e.jsxs("p",{className:"text-lg font-semibold",children:[l.soil_moisture_percentage.toFixed(1),"%"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(T,{className:"w-4 h-4 text-amber-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Soil Temp"}),e.jsxs("p",{className:"text-lg font-semibold",children:[l.soil_temperature.toFixed(1),"°C"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Q,{className:"w-4 h-4 text-purple-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"pH Level"}),e.jsx("p",{className:"text-lg font-semibold",children:l.ph_level.toFixed(1)})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(b,{className:"w-4 h-4 text-yellow-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Light"}),e.jsxs("p",{className:"text-lg font-semibold",children:[l.light_intensity_percentage.toFixed(0),"%"]})]})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(V,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"No live sensor data available. Connect ESP32 sensors and start MQTT bridge."}),e.jsx(x,{onClick:z,disabled:v,children:v?"Connecting...":"Connect to Sensors"})]}),D.length>0&&e.jsxs("div",{className:"mt-6 pt-6 border-t",children:[e.jsx("h4",{className:"text-sm font-semibold mb-3",children:"Device Status"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:D.map(s=>e.jsxs(Z,{variant:s.is_connected?"default":"destructive",className:"flex items-center space-x-1",children:[s.is_connected?e.jsx(G,{className:"w-3 h-3"}):e.jsx(V,{className:"w-3 h-3"}),e.jsx("span",{children:s.device_id})]},s.device_id))})]}),l&&e.jsxs("div",{className:"mt-6 pt-6 border-t flex space-x-3",children:[e.jsx(x,{onClick:ne,disabled:j,className:"flex-1",children:j?"Analyzing...":"Get Live Recommendations"}),e.jsx(x,{variant:"outline",onClick:()=>window.open("/api/sensors/soil-analysis/live","_blank"),className:"flex-1",children:"Live Soil Analysis"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs(w,{className:"shadow-medium",children:[e.jsxs(S,{children:[e.jsxs(F,{className:"flex items-center space-x-2",children:[e.jsx(O,{className:"w-5 h-5 text-primary"}),e.jsx("span",{children:t("sensor_data_input")})]}),e.jsx(C,{children:t("enter_readings")})]}),e.jsxs(M,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-foreground",children:t("environmental_conditions")}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs(m,{htmlFor:"temperature",className:"flex items-center space-x-2",children:[e.jsx(T,{className:"w-4 h-4"}),e.jsx("span",{children:t("temperature_c_label")})]}),e.jsx(h,{id:"temperature",placeholder:"25.5",value:r.temperature,onChange:s=>c("temperature",s.target.value)})]}),e.jsxs("div",{children:[e.jsxs(m,{htmlFor:"humidity",className:"flex items-center space-x-2",children:[e.jsx(U,{className:"w-4 h-4"}),e.jsx("span",{children:t("humidity_pct")})]}),e.jsx(h,{id:"humidity",placeholder:"65",value:r.humidity,onChange:s=>c("humidity",s.target.value)})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-foreground",children:t("soil_analysis")}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"soilMoisture",children:t("soil_moisture_pct")}),e.jsx(h,{id:"soilMoisture",placeholder:"45",value:r.soilMoisture,onChange:s=>c("soilMoisture",s.target.value)}),u.soilMoisture&&e.jsx("div",{className:"text-xs text-destructive mt-1",children:u.soilMoisture})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"ph",children:t("ph_level")}),e.jsx(h,{id:"ph",placeholder:"6.5",value:r.ph,onChange:s=>c("ph",s.target.value)}),u.ph&&e.jsx("div",{className:"text-xs text-destructive mt-1",children:u.ph})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"soilType",children:t("soil_type")}),e.jsxs(P,{value:r.soilType,onValueChange:s=>c("soilType",s),children:[e.jsx(q,{children:e.jsx(B,{placeholder:t("select_soil_type")})}),e.jsx(A,{children:$.map(s=>e.jsx(W,{value:s,children:s},s))})]})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"areaM2",children:t("area_m2")}),e.jsx(h,{id:"areaM2",placeholder:"100",value:r.areaM2,onChange:s=>c("areaM2",s.target.value)}),u.areaM2&&e.jsx("div",{className:"text-xs text-destructive mt-1",children:u.areaM2})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-foreground flex items-center space-x-2",children:[e.jsx(Q,{className:"w-4 h-4"}),e.jsx("span",{children:t("nutrient_levels_ppm")})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"nitrogen",children:t("nitrogen_n")}),e.jsx(h,{id:"nitrogen",placeholder:"120",value:r.nitrogen,onChange:s=>c("nitrogen",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"phosphorus",children:t("phosphorus_p")}),e.jsx(h,{id:"phosphorus",placeholder:"45",value:r.phosphorus,onChange:s=>c("phosphorus",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"potassium",children:t("potassium_k")}),e.jsx(h,{id:"potassium",placeholder:"80",value:r.potassium,onChange:s=>c("potassium",s.target.value)})]})]})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"cropType",children:t("crop_type")}),e.jsxs(P,{value:r.cropType,onValueChange:s=>c("cropType",s),children:[e.jsx(q,{children:e.jsx(B,{placeholder:t("select_crop_type")})}),e.jsx(A,{children:X.map(s=>e.jsx(W,{value:s.value,children:s.label},s.value))})]})]}),e.jsxs(x,{onClick:E,className:"w-full bg-gradient-primary hover:shadow-glow transition-spring",disabled:j||!r.cropType||!r.soilType||!(parseFloat(r.areaM2||"0")>0),children:[e.jsx(b,{className:"w-4 h-4 mr-2"}),t(j?"analyzing":"generate_recommendations")]})]})]}),e.jsxs(w,{className:"shadow-medium",children:[e.jsxs(S,{children:[e.jsxs(F,{className:"flex items-center space-x-2",children:[e.jsx(K,{className:"w-5 h-5 text-primary"}),e.jsx("span",{children:t("smart_recommendations")})]}),e.jsx(C,{children:t("ai_insights")})]}),e.jsx(M,{children:i?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border-l-4 p-4 rounded-lg bg-primary/5 border-l-primary",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("h4",{className:"font-semibold text-foreground flex items-center space-x-2",children:[ce("high"),e.jsx("span",{children:t("irrigation_fertilizer_plan")})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(x,{size:"sm",onClick:de,children:[e.jsx(je,{className:"w-4 h-4 mr-1"})," ",t("start")]}),e.jsxs(x,{size:"sm",variant:"destructive",onClick:oe,children:[e.jsx(ge,{className:"w-4 h-4 mr-1"})," ",t("stop")]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:t("water_liters_total")}),e.jsx("div",{className:"text-foreground font-medium",children:i.water_liters})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:t("water_source")}),e.jsx("div",{className:"text-foreground font-medium",children:i.water_source??"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:t("irrigation_cycles")}),e.jsx("div",{className:"text-foreground font-medium",children:i.irrigation_cycles??"-"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"N (g)"}),e.jsx("div",{className:"text-foreground font-medium",children:i.fert_n_g})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"P (g)"}),e.jsx("div",{className:"text-foreground font-medium",children:i.fert_p_g})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"K (g)"}),e.jsx("div",{className:"text-foreground font-medium",children:i.fert_k_g})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:t("runtime_min")}),e.jsx("div",{className:"text-foreground font-medium",children:i.suggested_runtime_min??"-"})]}),i.best_time&&e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:t("best_time")}),e.jsx("div",{className:"text-foreground font-medium",children:i.best_time})]})]})]}),(i.expected_savings_liters!=null||i.expected_cost_saving_rs!=null||i.expected_co2e_kg!=null)&&e.jsxs("div",{className:"border rounded-lg p-4 bg-card",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:t("impact")}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:t("water_saved_l")}),e.jsx("div",{className:"text-foreground font-medium",children:Math.round(i.expected_savings_liters||0)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:t("cost_saved_rs2")}),e.jsx("div",{className:"text-foreground font-medium",children:Math.round(i.expected_cost_saving_rs||0)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:t("co2e_kg2")}),e.jsx("div",{className:"text-foreground font-medium",children:(i.expected_co2e_kg||0).toFixed(2)})]})]})]}),i.fertilizer_equivalents&&e.jsxs("div",{className:"border rounded-lg p-4 bg-card",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:t("fertilizer_equivalents")}),e.jsx("ul",{className:"text-sm grid grid-cols-2 gap-2",children:Object.entries(i.fertilizer_equivalents).map(([s,a])=>e.jsxs("li",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:s}),e.jsx("span",{className:"font-medium",children:a})]},s))})]}),i.tips&&i.tips.length>0&&e.jsxs("div",{className:"border rounded-lg p-4 bg-card",children:[e.jsx("div",{className:"text-sm font-semibold mb-2",children:t("detailed_tips")}),e.jsx("ul",{className:"list-disc ml-5 space-y-1 text-sm",children:i.tips.map((s,a)=>e.jsx("li",{children:s},a))})]}),i.notes&&i.notes.length>0&&e.jsxs("div",{className:"border-l-4 p-4 rounded-lg bg-accent border-l-accent-foreground",children:[e.jsx("div",{className:"text-sm text-accent-foreground font-semibold mb-2",children:t("notes")}),e.jsx("ul",{className:"list-disc ml-5 space-y-1 text-sm",children:i.notes.map((s,a)=>e.jsx("li",{children:s},a))})]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(b,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:t("enter_sensor_prompt")})]})})]})]})]})})};export{ze as default};
