import{c as me,e as xe,r as n,j as e,B as E,m as x,_ as he}from"./index-AQOmLPA_.js";import{C as i,b as h,c as g,d as M,a as d}from"./card-CJ0__Qs_.js";import{I as U}from"./input-Cxy4wp14.js";import{L as _}from"./label-CDdM3ytP.js";import{S as V,a as B,b as $,c as H,d as u}from"./select-6AjSoAZR.js";import{B as f}from"./badge-jIK-DfEA.js";import{P as J}from"./progress-CcTMyZop.js";import{T as ge,a as pe,b as K,c as Y}from"./tabs-Bc9hHVt6.js";import{A as ue,a as je}from"./alert-CogJW0KU.js";import{E as fe,C as T,U as q}from"./upload-CXcjxWqy.js";import{B as G}from"./brain-iA1XsMGs.js";import{L as ye}from"./loader-circle-KFp7wWQw.js";import{L as _e}from"./leaf-BXutRLOs.js";import{C as Ne}from"./circle-check-BcQsHLEU.js";import{C as ve}from"./circle-alert-DDcVp7KT.js";import{C as be}from"./calendar-1ajBa6bT.js";const z=me("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),Me=()=>{const{t:l}=xe(),[b,Q]=n.useState(null),[k,X]=n.useState(null),[R,D]=n.useState(!1),[t,w]=n.useState(null),[j,Z]=n.useState(""),[C,ee]=n.useState(""),F=n.useRef(null),[y,se]=n.useState(null),[P,ae]=n.useState("wheat"),[S,W]=n.useState(!1),[o,O]=n.useState(null),[A,L]=n.useState(null),te=["corn","soybean","wheat","cotton","rice","tomato","potato","sugar_beet","sunflower","canola"],le=s=>{const a=s.target.files?.[0];if(a){if(a.size>10*1024*1024){x.error("Image size must be less than 10MB");return}Q(a);const m=new FileReader;m.onload=N=>{X(N.target?.result)},m.readAsDataURL(a)}},re=async()=>{if(!b||!j){x.error("Please select an image and crop type");return}D(!0),w(null);try{const s=new FileReader;s.onload=async()=>{const m=s.result.split(",")[1];let N=!1;try{const{detectWeedsWithScold:p}=await he(async()=>{const{detectWeedsWithScold:I}=await import("./aiModels-CYIggAQi.js");return{detectWeedsWithScold:I}},[]);x.info("ðŸ” Using SCOLD VLM for advanced weed detection...");const r=await p(m,j);if(r.success&&r.detections.length>0){const I={weed_coverage_percentage:r.total_weed_coverage,weed_pressure:r.total_weed_coverage>30?"high":r.total_weed_coverage>15?"moderate":"low",dominant_weed_types:r.detections.map(c=>c.weed_type),weed_regions:r.detections.map((c,v)=>({region_id:`region-${v}`,weed_type:c.weed_type,coverage_percentage:c.coverage_percent||0,density:c.coverage_percent&&c.coverage_percent>20?"high":"moderate",coordinates:c.bbox||[]})),management_plan:{recommended_actions:r.detections.slice(0,3).map((c,v)=>({action_type:c.treatment?.manual_removal[0]||"Manual removal",priority:v===0?"high":"medium",method:c.treatment?.mulching[0]||"Mulching",timing:"Immediate",cost_estimate:50*(v+1)})),herbicide_recommendations:r.detections.slice(0,2).map(c=>({product_name:c.treatment?.organic_herbicides[0]||"Organic herbicide",active_ingredient:"Natural compounds",application_rate:"As directed",target_weeds:[c.weed_type],cost_per_acre:75})),cultural_practices:r.detections[0]?.treatment?.prevention_tips||[]},economic_analysis:{potential_yield_loss:r.total_weed_coverage*.5,control_cost_estimate:r.detections.length*100,roi_estimate:2.5},vlm_analysis:{knowledge_matches:r.detections.length,confidence_score:r.detections[0]?.confidence||0,analysis_timestamp:r.timestamp}};w(I),x.success("âœ… SCOLD VLM weed analysis completed!"),N=!0}}catch(p){console.info("SCOLD VLM unavailable, using fallback detection:",p)}if(!N){x.info("Using standard weed detection...");const p=await fetch("/api/weed/analyze",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image_data:m,crop_type:j,field_info:{crop_type:j,field_size_acres:C?parseFloat(C):1}})});if(!p.ok)throw new Error(`Analysis failed: ${p.statusText}`);const r=await p.json();w(r),x.success("Weed analysis completed!")}},s.readAsDataURL(b)}catch(s){console.error("Analysis error:",s),x.error("Failed to analyze image. Please try again.")}finally{D(!1)}},ce=s=>{switch(s?.toLowerCase()){case"low":return"bg-green-100 text-green-800 border-green-200";case"moderate":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"high":return"bg-orange-100 text-orange-800 border-orange-200";case"severe":return"bg-red-100 text-red-800 border-red-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},ne=s=>{switch(s?.toLowerCase()){case"low":return"bg-blue-100 text-blue-800";case"medium":return"bg-yellow-100 text-yellow-800";case"high":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},ie=n.useCallback(s=>{const a=s.target.files?.[0];if(a){const m=new FileReader;m.onloadend=()=>{se(m.result),O(null),L(null)},m.readAsDataURL(a)}},[]),de=async()=>{if(y){W(!0),L(null);try{const s=y.split(",")[1],a=await fetch("http://localhost:8004/api/weed/analyze",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image_data:s,crop_type:P})});if(!a.ok)throw new Error(`Analysis failed: ${a.statusText}`);const m=await a.json();O(m),x.success("SCOLD weed analysis completed!")}catch(s){const a=s instanceof Error?s.message:"Analysis failed";L(a),x.error(a),console.error("SCOLD weed identification error:",s)}finally{W(!1)}}},oe=s=>{switch(s.toLowerCase()){case"high":case"severe":return"text-red-600 bg-red-50 border-red-200";case"medium":case"moderate":return"text-yellow-600 bg-yellow-50 border-yellow-200";case"low":case"minimal":return"text-green-600 bg-green-50 border-green-200";default:return"text-gray-600 bg-gray-50 border-gray-200"}};return e.jsxs("div",{className:"container mx-auto p-6 max-w-7xl",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground mb-2",children:"Weed Management System"}),e.jsx("p",{className:"text-muted-foreground",children:"Advanced AI-powered weed detection with multiple analysis methods"})]}),e.jsxs(ge,{defaultValue:"scold",className:"w-full",children:[e.jsxs(pe,{className:"grid w-full grid-cols-2 mb-6",children:[e.jsxs(K,{value:"scold",className:"flex items-center gap-2",children:[e.jsx(fe,{className:"w-4 h-4"}),"SCOLD VLM Detection"]}),e.jsxs(K,{value:"standard",className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4"}),"Standard Detection"]})]}),e.jsx(Y,{value:"scold",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(i,{children:[e.jsxs(h,{children:[e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(T,{className:"w-5 h-5"}),l("scold_upload_field","Upload Field Image")]}),e.jsx(M,{children:l("scold_weed_subtitle","AI-powered weed detection and crop field analysis")})]}),e.jsxs(d,{className:"space-y-4",children:[e.jsx("div",{className:"mb-4",children:y?e.jsx("img",{src:y,alt:"Selected field",className:"w-full h-64 object-cover rounded-lg border-2 border-gray-200"}):e.jsx("div",{className:"w-full h-64 bg-gray-100 rounded-lg border-2 border-dashed border-gray-300 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(q,{className:"w-12 h-12 mx-auto mb-2 text-gray-400"}),e.jsx("p",{className:"text-gray-600",children:l("scold_no_image","No image selected")})]})})}),e.jsxs("label",{className:"block",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:ie,className:"hidden"}),e.jsx("div",{className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 cursor-pointer text-center transition-colors",children:l("scold_choose_file","Choose Image File")})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"scold-crop-type",children:l("scold_crop_type","Crop Type")}),e.jsxs(V,{value:P,onValueChange:ae,children:[e.jsx(B,{id:"scold-crop-type",children:e.jsx($,{})}),e.jsxs(H,{children:[e.jsx(u,{value:"wheat",children:l("crop_wheat","Wheat")}),e.jsx(u,{value:"rice",children:l("crop_rice","Rice")}),e.jsx(u,{value:"corn",children:l("crop_corn","Corn")}),e.jsx(u,{value:"soybean",children:l("crop_soybean","Soybean")}),e.jsx(u,{value:"cotton",children:l("crop_cotton","Cotton")}),e.jsx(u,{value:"sugarcane",children:l("crop_sugarcane","Sugarcane")})]})]})]}),e.jsx(E,{onClick:de,disabled:!y||S,className:"w-full",size:"lg",children:S?e.jsxs(e.Fragment,{children:[e.jsx(ye,{className:"w-5 h-5 mr-2 animate-spin"}),l("scold_analyzing","Analyzing...")]}):l("scold_identify_button","Identify Weeds")})]})]}),e.jsxs("div",{className:"space-y-4",children:[A&&e.jsxs(ue,{variant:"destructive",children:[e.jsx(AlertTriangle,{className:"w-5 h-5"}),e.jsx(je,{children:A})]}),o&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(i,{children:e.jsx(d,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:l("scold_analysis_method","Analysis Method")}),e.jsx(f,{variant:"outline",className:"bg-blue-100 text-blue-800",children:o.analysis_method==="scold_vlm"?"SCOLD VLM":o.analysis_method})]})})}),e.jsx(i,{children:e.jsxs(d,{className:"pt-6 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:l("scold_infestation_level","Infestation Level")}),e.jsx(f,{className:oe(o.overall_infestation),children:o.overall_infestation})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-xs text-gray-600 mb-1",children:[e.jsx("span",{children:l("scold_total_coverage","Total Weed Coverage")}),e.jsxs("span",{children:[o.total_coverage.toFixed(1),"%"]})]}),e.jsx(J,{value:o.total_coverage,className:"h-2"})]})]})}),o.detections.length>0?e.jsxs(i,{children:[e.jsx(h,{children:e.jsx(g,{className:"text-lg",children:l("scold_detected_weeds","Detected Weed Species")})}),e.jsx(d,{children:e.jsx("div",{className:"space-y-3",children:o.detections.map((s,a)=>e.jsxs("div",{className:"border rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_e,{className:"w-4 h-4 text-green-600"}),e.jsx("h4",{className:"font-medium capitalize",children:s.weed_name.replace(/_/g," ")})]}),e.jsxs(f,{variant:"outline",children:[(s.confidence*100).toFixed(0),"%"]})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsxs("span",{children:[l("scold_coverage","Coverage"),": "]}),e.jsxs("span",{className:"font-semibold",children:[s.coverage_percentage.toFixed(1),"%"]})]}),s.location_description&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s.location_description})]},a))})})]}):e.jsx(i,{children:e.jsx(d,{className:"flex items-center justify-center h-32 text-center",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ne,{className:"w-12 h-12 mx-auto text-green-600"}),e.jsx("p",{className:"text-green-600 font-medium",children:l("scold_no_weeds","No weeds detected - field looks clean!")})]})})}),o.recommendations.length>0&&e.jsxs(i,{children:[e.jsx(h,{children:e.jsx(g,{className:"text-lg",children:l("scold_control_recommendations","Control Recommendations")})}),e.jsx(d,{children:e.jsx("ul",{className:"space-y-2",children:o.recommendations.map((s,a)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(z,{className:"w-4 h-4 text-blue-600 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:s})]},a))})})]})]}),!o&&!A&&!S&&e.jsx(i,{className:"border-dashed",children:e.jsx(d,{className:"flex items-center justify-center h-64 text-center",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{className:"w-16 h-16 mx-auto text-gray-400"}),e.jsx("p",{className:"text-gray-600",children:l("scold_upload_field_prompt","Upload a field image and click identify to detect weeds")})]})})})]})]})}),e.jsx(Y,{value:"standard",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(i,{children:[e.jsxs(h,{children:[e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(T,{className:"w-5 h-5"}),"Field Image Analysis"]}),e.jsx(M,{children:"Upload a field image to detect and analyze weed coverage"})]}),e.jsxs(d,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{htmlFor:"crop-type",children:"Crop Type *"}),e.jsxs(V,{value:j,onValueChange:Z,children:[e.jsx(B,{children:e.jsx($,{placeholder:"Select crop type"})}),e.jsx(H,{children:te.map(s=>e.jsx(u,{value:s,children:s.replace(/_/g," ").charAt(0).toUpperCase()+s.replace(/_/g," ").slice(1)},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{htmlFor:"field-size",children:"Field Size (acres)"}),e.jsx(U,{id:"field-size",type:"number",step:"0.1",min:"0.1",value:C,onChange:s=>ee(s.target.value),placeholder:"e.g., 5.2"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{children:"Field Image Upload"}),e.jsx("div",{className:"border-2 border-dashed border-muted-foreground/25 rounded-lg p-6 text-center cursor-pointer hover:border-muted-foreground/50 transition-colors",onClick:()=>F.current?.click(),children:k?e.jsxs("div",{className:"space-y-2",children:[e.jsx("img",{src:k,alt:"Preview",className:"max-w-full max-h-48 mx-auto rounded-lg"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Click to change image"})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{className:"w-8 h-8 mx-auto text-muted-foreground"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Click to upload field image"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Best results with overhead or side-view field images"})]})}),e.jsx(U,{ref:F,type:"file",accept:"image/*",onChange:le,className:"hidden"})]}),e.jsx(E,{onClick:re,disabled:!b||!j||R,className:"w-full",size:"lg",children:R?"Analyzing...":"Analyze Weed Coverage"})]})]}),t&&e.jsxs(i,{children:[e.jsx(h,{children:e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-5 h-5"}),"Weed Analysis Results"]})}),e.jsxs(d,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-lg",children:[t.weed_coverage_percentage.toFixed(1),"% Weed Coverage"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[t.weed_regions.length," weed regions detected"]})]}),e.jsxs(f,{className:ce(t.weed_pressure),children:[t.weed_pressure," Pressure"]})]}),e.jsxs("div",{children:[e.jsx(_,{className:"text-sm font-medium",children:"Weed Coverage"}),e.jsx(J,{value:t.weed_coverage_percentage,className:"h-3 mt-1"})]}),t.dominant_weed_types.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Dominant Weed Types"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:t.dominant_weed_types.map((s,a)=>e.jsx(f,{variant:"outline",children:s.replace(/_/g," ")},a))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Potential Yield Loss"}),e.jsxs("p",{className:"font-semibold text-red-600",children:[t.economic_analysis.potential_yield_loss,"%"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Control Cost"}),e.jsxs("p",{className:"font-semibold",children:["$",t.economic_analysis.control_cost_estimate]})]})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 p-3 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-green-800 mb-1",children:"ROI Estimate"}),e.jsxs("p",{className:"text-sm text-green-700",children:[t.economic_analysis.roi_estimate,"% return on investment"]})]}),t.vlm_analysis&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(G,{className:"w-4 h-4 text-blue-600"}),e.jsx("h4",{className:"font-semibold text-blue-800",children:"VLM Enhanced Analysis"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-600",children:"Knowledge Matches"}),e.jsx("p",{className:"font-semibold",children:t.vlm_analysis.knowledge_matches})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-600",children:"AI Confidence"}),e.jsxs("p",{className:"font-semibold",children:[(t.vlm_analysis.confidence_score*100).toFixed(1),"%"]})]})]}),t.vlm_analysis.visual_features&&e.jsx("div",{className:"mt-2 text-xs text-blue-700",children:e.jsxs("p",{children:["Visual Analysis: ",t.vlm_analysis.visual_features.contour_count," features detected"]})})]})]})]}),!t&&e.jsx(i,{className:"border-dashed",children:e.jsx(d,{className:"flex items-center justify-center h-64 text-center",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"w-16 h-16 mx-auto bg-muted rounded-full flex items-center justify-center",children:e.jsx(z,{className:"w-8 h-8 text-muted-foreground"})}),e.jsx("p",{className:"text-muted-foreground",children:"Upload a field image to see weed analysis results"})]})})})]}),t?.management_plan&&e.jsxs("div",{className:"mt-6 grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(i,{children:[e.jsx(h,{children:e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"w-5 h-5"}),"Recommended Actions"]})}),e.jsx(d,{children:e.jsx("div",{className:"space-y-3",children:t.management_plan.recommended_actions.map((s,a)=>e.jsxs("div",{className:"border rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h4",{className:"font-medium",children:s.method}),e.jsx(f,{className:ne(s.priority),variant:"outline",children:s.priority})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:s.action_type}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(be,{className:"w-3 h-3"}),s.timing]}),e.jsxs("span",{className:"font-medium text-green-600",children:["$",s.cost_estimate]})]})]},a))})})]}),e.jsxs(i,{children:[e.jsx(h,{children:e.jsx(g,{children:"Herbicide Recommendations"})}),e.jsx(d,{children:e.jsx("div",{className:"space-y-3",children:t.management_plan.herbicide_recommendations.map((s,a)=>e.jsxs("div",{className:"border rounded-lg p-3",children:[e.jsx("h4",{className:"font-medium",children:s.product_name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Active ingredient: ",s.active_ingredient]}),e.jsxs("p",{className:"text-sm",children:["Rate: ",s.application_rate]}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Targets: "}),s.target_weeds.slice(0,2).join(", "),s.target_weeds.length>2&&"..."]}),e.jsxs("span",{className:"font-medium text-green-600",children:["$",s.cost_per_acre,"/acre"]})]})]},a))})})]})]}),t?.management_plan.cultural_practices&&t.management_plan.cultural_practices.length>0&&e.jsxs(i,{className:"mt-6",children:[e.jsx(h,{children:e.jsx(g,{children:"Cultural Control Practices"})}),e.jsx(d,{children:e.jsx("ul",{className:"space-y-2",children:t.management_plan.cultural_practices.map((s,a)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-primary rounded-full mt-2 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:s})]},a))})})]})]})})]})]})};export{Me as default};
