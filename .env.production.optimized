# ============================================================================
# HARDWARE-OPTIMIZED PRODUCTION ENVIRONMENT
# Intel Core Ultra 9 275HX (32 threads) + RTX 5060 Laptop GPU (8GB)
# ============================================================================

# === Application Settings ===
APP_NAME=AgriSense
APP_ENV=production
DEBUG=0
LOG_LEVEL=INFO
PORT=8004

# === Performance: CPU Threading (32 threads total) ===
# Uvicorn workers: 8 (one per P-core for load balancing)
UVICORN_WORKERS=8
UVICORN_WORKER_CONNECTIONS=2000
UVICORN_BACKLOG=4096
UVICORN_KEEPALIVE=75
UVICORN_MAX_REQUESTS=0
UVICORN_TIMEOUT_KEEP_ALIVE=75
UVICORN_TIMEOUT_GRACEFUL_SHUTDOWN=30

# === OpenMP/MKL Threading (utilize all 24 logical cores) ===
OMP_NUM_THREADS=24
MKL_NUM_THREADS=24
NUMEXPR_NUM_THREADS=24
OPENBLAS_NUM_THREADS=24
VECLIB_MAXIMUM_THREADS=24

# === Python Threading ===
PYTHONTHREADED=1
ASYNCIO_WORKERS=16
THREAD_POOL_SIZE=28

# === GPU Configuration (RTX 5060) ===
CUDA_VISIBLE_DEVICES=0
TF_GPU_THREAD_MODE=gpu_private
TF_GPU_THREAD_COUNT=4
PYTORCH_CUDA_ALLOC_CONF=max_split_size_mb:512
CUDA_LAUNCH_BLOCKING=0
TF_FORCE_GPU_ALLOW_GROWTH=true
TF_GPU_ALLOCATOR=cuda_malloc_async

# === Database Connection Pooling ===
DB_POOL_SIZE=100
DB_MAX_OVERFLOW=50
DB_POOL_TIMEOUT=30
DB_POOL_RECYCLE=3600
DB_POOL_PRE_PING=true
DB_ECHO=0

# === Redis Caching ===
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_DB=0
REDIS_POOL_SIZE=50
REDIS_MAX_CONNECTIONS=100
REDIS_SOCKET_KEEPALIVE=true
REDIS_SOCKET_KEEPALIVE_OPTIONS=1,30,10
REDIS_DECODE_RESPONSES=true

# === ML Model Configuration ===
AGRISENSE_DISABLE_ML=0
ML_BATCH_SIZE=128
ML_NUM_WORKERS=16
ML_PREFETCH_FACTOR=4
ML_PERSISTENT_WORKERS=true
ML_PIN_MEMORY=true
ML_USE_MULTIPROCESSING=true

# Model caching
MODEL_CACHE_SIZE=1000
MODEL_CACHE_TTL=3600
ENABLE_MODEL_WARMUP=true

# === Application Caching ===
ENABLE_CACHE=true
CACHE_BACKEND=redis
CACHE_DEFAULT_TIMEOUT=3600
CACHE_KEY_PREFIX=agrisense:
CACHE_VERSION=1

# Response caching
ENABLE_RESPONSE_CACHE=true
RESPONSE_CACHE_TTL=300
STATIC_CACHE_TTL=86400

# === Request Processing ===
MAX_REQUEST_SIZE=50000000
MAX_CONCURRENT_REQUESTS=500
REQUEST_TIMEOUT=300
SLOW_REQUEST_THRESHOLD=1.0

# === Background Tasks (Celery) ===
CELERY_WORKERS=8
CELERY_PREFETCH_MULTIPLIER=4
CELERY_MAX_TASKS_PER_CHILD=1000
CELERY_TASK_TIME_LIMIT=600
CELERY_TASK_SOFT_TIME_LIMIT=540

# === Logging ===
LOG_FORMAT=json
LOG_BUFFER_SIZE=8192
ENABLE_REQUEST_LOGGING=true
LOG_SLOW_QUERIES=true
SLOW_QUERY_THRESHOLD=0.5

# === Compression ===
ENABLE_GZIP=true
GZIP_MINIMUM_SIZE=1024
GZIP_COMPRESSION_LEVEL=6

# === Feature Flags ===
ENABLE_WEBSOCKETS=true
ENABLE_REAL_TIME_ALERTS=true
ENABLE_ADVANCED_ANALYTICS=true
ENABLE_ML_RECOMMENDATIONS=true
ENABLE_BATCH_PROCESSING=true
ENABLE_PARALLEL_PROCESSING=true

# === Security & Rate Limiting ===
RATE_LIMITING_ENABLED=true
DEFAULT_RATE_LIMIT=1000
DEFAULT_RATE_WINDOW=60
BURST_RATE_LIMIT=2000

# === Monitoring ===
ENABLE_METRICS=true
METRICS_PORT=9090
ENABLE_HEALTH_CHECKS=true
HEALTH_CHECK_INTERVAL=30

# === CORS Configuration ===
CORS_ORIGINS=http://localhost:5173,http://localhost:3000,http://localhost:8004
CORS_ALLOW_CREDENTIALS=true
CORS_ALLOW_METHODS=*
CORS_ALLOW_HEADERS=*

# === Static Files ===
STATIC_FILE_MAX_AGE=86400

# === Database (SQLite for dev, PostgreSQL for prod) ===
# SQLite Configuration
SQLITE_DATABASE=sensors.db
SQLITE_JOURNAL_MODE=WAL
SQLITE_SYNCHRONOUS=NORMAL
SQLITE_CACHE_SIZE=-64000
SQLITE_PAGE_SIZE=8192
SQLITE_TEMP_STORE=MEMORY
SQLITE_MMAP_SIZE=268435456
SQLITE_THREADS=16

# PostgreSQL Configuration (uncomment for production)
# DATABASE_URL=postgresql+asyncpg://user:pass@localhost:5432/agrisense
# DB_DRIVER=postgresql+asyncpg
# DB_MIN_POOL_SIZE=20
# DB_MAX_POOL_SIZE=100

# === Frontend Assets ===
FRONTEND_BUILD_PATH=agrisense_app/frontend/farm-fortune-frontend-main/dist
SERVE_FRONTEND=true

# === External Services ===
# OpenWeather API
OPENWEATHER_API_KEY=your_key_here
WEATHER_CACHE_TTL=1800

# Azure OpenAI (optional)
AZURE_OPENAI_KEY=your_key_here
AZURE_OPENAI_ENDPOINT=your_endpoint_here
AZURE_OPENAI_DEPLOYMENT=gpt-4

# === Development Overrides (remove in true production) ===
# Uncomment below for strict production settings
# DEBUG=0
# RELOAD_ON_CHANGE=0
# ENABLE_REQUEST_LOGGING=false
